# movie-lib

## Описание

Данный проект представляет собой приложение фильмотеки, в которой можно 
хранить фильмы и актёров.

Все операции над фильмами и актёрами осуществляются через API. Выполнять 
операции могут только зарегистрированные пользователи, причём изменять данные 
могут только пользователи с правами администратора, получать данные могут все 
зарегистрированные пользователи. Добавить новых пользователей можно только 
через базу данных напрямую, по умолчанию созданы 2 пользователя, один из них 
с правами администратора.

## Бизнес-логика

Формат взаимодействия с API доступен в swagger-документации по адресу 
[http://localhost:8080/swagger/index.html](http://localhost:8080/swagger/index.html)

### Авторизация

Для того чтобы иметь доступ к выполнению операций необходимо пройти 
авторизацию. Для этого в запрос необходимо добавить заголовок `Authorization` 
со значением id пользователя (по умолчанию созданы пользователь с правами 
администратора с id `1` и пользователь без прав с id `2`).

### Основные сущности

Основными сущностями являются фильм (`movie`) и актёр (`actor`). Возвращённый 
сервисом фильм содержит список актёров, которые играли в этом фильме. 
Возвращённый сервисом актёр содержит список фильмов, в которых он принимал 
участие. При добавлении/обновлении фильма можно задать список id актёров, 
которые играли в этом фильме.

#### Информация о фильме:

* id
* Название (от 1 до 150 символов)
* Описание (до 1000 символов)
* Дата выхода (в формате timestamp)
* Рейтинг (от 1 до 10)

#### Информация об актёре:

* id
* Имя
* Фамилия
* Пол (male/female)

## Детали реализации

В качестве СУБД используется PostgreSQL.

HTTP-сервер реализован средствами стандартной библиотеки 
[net/http](https://pkg.go.dev/net/http).

Бизнес-логика покрыта unit-тестами, покрытие составляет **87.2%** 
(*чтобы добиться такого покрытия, пришлось отказаться от мокирования интерфейса 
БД, тем не менее тестирование реализовано так, чтобы проведение всех тестов 
никак не влияло на данные в БД*).

Присутствует логирование запросов к серверу, в логи попадает время запроса, 
метод, адрес и код ответа.

## Инструкция по запуску

### Запуск приложения

```shell
make run
```

или

```shell
docker-compose --profile release up
```

### Запуск тестов

```shell
make test
```
